![image](https://github.com/smadi0x86/MalwareHolmes/assets/75253629/d2e17a91-8b2a-427a-a0dc-f30a1052715a)

<h1 align="center">
  MalwareHolmes üîé
  <br>
</h1>

<h3 align="center">Built with ‚ù§Ô∏è</h3>

<p align="center">
  <a href="">
    <img src="https://img.shields.io/badge/apache_maven-C71A36?style=for-the-badge&logo=apachemaven&logoColor=white">
    <img src="https://img.shields.io/badge/-Language-blue?style=for-the-badge&logo=c">
    <img src="https://img.shields.io/badge/Java-ED8B00?style=for-the-badge&logo=openjdk&logoColor=white">
    <img src="https://img.shields.io/badge/VScode-0078D4?style=for-the-badge&logo=visual%20studio%20code&logoColor=white">
    <img src="https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white">
    <img src="https://img.shields.io/badge/redis-%23DD0031.svg?style=for-the-badge&logo=redis&logoColor=white">
  </a>
  </p>
  
<p align="center">
  <a href="">
 <img src ="https://img.shields.io/github/forks/smadi0x86/MalwareHolmes?style=social"> <img src ="https://img.shields.io/github/stars/smadi0x86/MalwareHolmes?style=social"> <img src ="https://img.shields.io/github/license/smadi0x86/MalwareHolmes"> <img src="https://img.shields.io/github/downloads/smadi0x86/MalwareHolmes/total"> <img src ="https://img.shields.io/github/contributors/smadi0x86/MalwareHolmes?color=red">
  </a>
</p>

**The Malware Holmes is a Java project that performs analysis by monitoring a file being added to a given folder to detect malicious behavior and potential security risks.**

**It leverages native code written in C to access low-level capabilities and enhance the analysis process.**


# ü§© Features

```
The Malware Analyzer project offers the following features:
```

- [x] **Static Analysis**: The project performs static analysis on files to identify potential malware and security risks.
- [x] **PE Analysis**: The project allows the analysis of Portable Executable (PE) files commonly found in Windows operating systems.
- [x] **Signature-based Detection**: It utilizes a signature database to match known malware signatures and identify malicious files based on hash values.
- [x] **Directory Monitoring**: The project provides a directory monitoring service that continuously scans a specified directory for new files and analyzes them in real-time.
- [x] **Native Code Integration**: Native C code is integrated using Java Native Interface (JNI) to access low-level capabilities and perform advanced analysis techniques.
- [x] **Logging**: Every file that is added to the monitored directory is logged onto an external txt file which is saved in the directory you ran the program from which helps in machine learning.
- [x] **Redis**: The project uses Redis, an in-memory data structure store as a database for quick and efficient access to data. It uses Redis to store and retrieve malware signatures for file analysis. 

```
Planned but not Implemented yet:
```

- [X] **MalwareBaazar API**: Implement POST requests to MalwareBaazar API using different queries, so it can check the generated hash of files on its malware hashes database and give informations such as: malware family, yara rules etc... if found.
- [ ] **Advanced Static Analysis**: Implement more advanced static analysis such as using disassemblers and run automated analysis on the disassembled PE file and do more static analysis techniques on normal files i.e: pdf, txt etc...
- [ ] **Dynamic Analysis**: The project performs dynamic analysis on executable files to identify potential malware and security risks using different techniques such as API Hooking.
- [ ] **Container Protection**: The project runs dynamic analysis on executables in an isolated lightweight docker container which prevents any malware execution damage to your host machine.
- [ ] **Integration with email system**: Let downloaded attachments from email inbox get saved to a folder and MalwareHolmes monitor it automatically.
- [ ] **Cross-compatibility**: Let MalwareHolmes run on both linux and windows systems, change native C compiling to .so instead of .dll for example.

# ü™ê Prerequisites

***In order to run this application, you will need the following:***

[Redis](https://redis.io/download)

```
Please ensure these are installed and correctly set up before proceeding.
```

***For development, the following tools are optional:***

[Java Development Kit (JDK) version 8 or higher](https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html)

[Apache Maven](https://maven.apache.org/download.cgi)

[MinGW gcc compiler](http://mingw-w64.org/doku.php/start)

[Redis](https://redis.io/download)

[Visual Studio Code](https://code.visualstudio.com/download)

# üìù Usage

***Clone the repository:***

```bash
git clone https://github.com/smadi0x86/MalwareHolmes
```

***You have 3 choices for running this project either by using the pre-built release, build with a script or manually building it.***

## Pre-built Version

**You can run the pre-built executable (MalwareHolmes.exe) by installing it directly from the releases.**

***After downloading the pre-built binary, you can run it like any normal executable by double clicking on it.***

```
Note: When running the exe make sure you have redis setup and running for optimal experience.
```

## Script Build

The project provides a bash script that automates the setup and execution process. 

***Before running this script, ensure that the following dependencies are installed on your machine:***

- *Java Development Kit (JDK)*
- *Apache Maven*
- *gcc compiler*
- *Docker*
  
***To execute the script, open a Git Bash or any bash terminal and navigate to the root directory of the project.***

***Run the script with the command:***

```bash
chmod +x auto_run.sh
./auto_run.sh
```

***This script performs several tasks:***

- *Verifies the installation of the necessary dependencies (JDK, Maven, GCC, Docker)*
- *Compiles the C code into DLLs using GCC*
- *Builds the Maven project*
- *Starts a Redis Docker container*
- *Runs the Java application*
- *The script assumes that the JDK is installed under the JAVA_HOME environment variable.*

```
Ensure JAVA_HOME is correctly set to your JDK installation path before running the script.
Please make sure that Docker is running on your machine before you execute the script.
```

## Manual Build  

This command builds the project and packages it into a JAR file. The resulting JAR file can be found in the `/target` directory.

***Compiling native C code using gcc:***

**Move to maven-final-programming-quickpick/src/main/java/Malware/logic/peAnalysis directory on your terminal then run:**

```bash
gcc -I"C:\Program Files\Java\jdk-19\include" -I"C:\Program Files\Java\jdk-19\include\win32" -shared -o peAnalysis.dll peAnalysis.c pemetaData.c
```

**Move to maven-final-programming-quickpick/src/main/java/Malware/logic/staticAnalysis directory on your terminal then run:**

```bash
gcc -I"C:\Program Files\Java\jdk-19\include" -I"C:\Program Files\Java\jdk-19\include\win32" -shared -o staticAnalysis.dll staticAnalysis.c
```

***NOTE: Change path based on your jdk version, mine is jdk-19. After that move both dlls to Main.java directory.***

***Make sure to move the dll generated by the compiler to the same directory of the Main.java (The start of program).***

![image](https://github.com/smadi0x86/MalwareHolmes/assets/75253629/ad53b5f0-116f-4ba4-9529-5aef26bbe075)

***Now to build the project, navigate to the project directory and execute the following command:***

```bash
mvn clean package
```

***Pull and run the Redis Docker container:***

```bash
docker run --name some-redis -d -p 6379:6379 redis
```

**This will start a Redis instance on your local machine on port 6379.**

![image](https://github.com/smadi0x86/MalwareHolmes/assets/75253629/9b171aa8-1ad6-40f3-a355-643204fc83a5)

***After building the project, you can run it using the following command:***

```bash
java -Djava.library.path="{changeme}\maven-final-programming-quickpick\src\main\java" -jar target/maven-final-programming-quickpick-1.0-SNAPSHOT-jar-with-dependencies.jar
```

**You will be prompted to enter the path of the directory you want to monitor for malware.**

# ‚ôæÔ∏è Continuous Integration and Deployment (CI/CD)

**The Malware Analyzer project includes CI/CD pipelines for automated building, testing, and analysis. These pipelines are configured using GitHub Actions.**

### Unit Testing

The unit testing workflow is triggered on each push to the repository. It runs unit tests to ensure the correctness of the implemented methods.

### Maven Build

The Maven build workflow is triggered on each push to the repository. It performs the Maven build process for the project.

### CodeQL Analysis

The CodeQL analysis workflow is triggered on each push to the repository. It performs static analysis using CodeQL to identify security issues and potential vulnerabilities.

### Dependabot

Dependabot is configured to automate the creation of pull requests for any detected security issues or dependency updates. It ensures that your project stays up to date with the latest security patches and dependencies.

These CI/CD pipelines streamline the development process, automating tasks such as building, testing, and code analysis.

These pipelines enable continuous integration, automated testing, and code analysis, providing confidence in the project's stability and security.

# ü§ù Contributing

***Contributions to the Malware Analyzer project are welcome! If you would like to contribute, please follow these steps:***

- Fork the repository.
- Create a new branch for your feature or bug fix.
- Make your changes and commit them.
- Push your changes to your forked repository.
- Open a pull request, describing your changes and the motivation behind them.

# üìú License

This project is licensed under the [MIT LICENSE](https://github.com/smadi0x86/MalwareHolmes/blob/master/LICENSE)

# üìô References

http://www.pelib.com/examples.php
https://github.com/NtRaiseHardError/Dreadnought
https://gist.github.com/RachidAZ/d3c469cde5cf2498a451a7b9ba251b2d

# üìû Contact :

<p align="center">
<a href="https://linkedin.com/in/saud-smadi" target="blank"><img align="center" src="https://cdn.jsdelivr.net/npm/simple-icons@3.0.1/icons/linkedin.svg" alt="smadi" height="25" width="25" /></a>
<a href="https://twitter.com/@smadi0x86" target="blank"><img align="center" src="https://cdn.jsdelivr.net/npm/simple-icons@7.5.0/icons/twitter.svg" alt="smadi" height="25" width="25" /></a>
<a href="https://t.me/rootsmadi" target="blank"><img align="center" src="https://cdn.jsdelivr.net/npm/simple-icons@3.0.1/icons/telegram.svg" alt="smadi" height="25" width="25" /></a>
<a href="https://smadi0x86-blog.gitbook.io/smadi0x86-blog/" target="blank"><img align="center" src="https://cdn.jsdelivr.net/npm/simple-icons@7.5.0/icons/gitbook.svg" alt="smadi" height="25" width="25" /></a>
</p>
