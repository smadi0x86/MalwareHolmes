import java.io.IOException;
import java.nio.file.*;

import Malware.logic.MalwareAnalyzer;
import Malware.logic.ManualMalwareAnalyzer;
import Malware.logic.SignatureDatabase;
import Malware.logic.SignatureIdentifier;
import Malware.logic.DirectoryMonitorService;

public class Main {
    public static void main(String[] args) {

        SignatureDatabase signatureDatabase = new SignatureDatabase();

        try {
            signatureDatabase.loadSignaturesFromFile("src/main/java/resources/malware_hashes.csv");
        } catch (IOException e) {
            System.err.println("IO Error: " + e.getMessage());
            e.printStackTrace();
        }

        SignatureIdentifier signatureIdentifier = new SignatureIdentifier(signatureDatabase);
        MalwareAnalyzer malwareAnalyzer = new MalwareAnalyzer(signatureIdentifier);

        // Pass a filter to DirectoryMonitorService to ignore .crdownload files
        DirectoryMonitorService directoryMonitorService = new DirectoryMonitorService(
                Paths.get("C:/testing"),
                malwareAnalyzer,
                path -> !path.toString().endsWith(".crdownload"));

        Thread directoryMonitorThread = new Thread(directoryMonitorService);
        directoryMonitorThread.start();

    }
}
